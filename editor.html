<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor - MangaMotion AI</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/public/css/design-system.css" as="style">
    <link rel="preload" href="/public/css/main.css" as="style">
    <link rel="preload" href="/public/css/animations.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" as="style">

    <link rel="stylesheet" href="/public/css/design-system.css?v=2">
    <link rel="stylesheet" href="/public/css/main.css?v=2">
    <link rel="stylesheet" href="/public/css/animations.css?v=2">
    <link rel="stylesheet" href="/public/css/footer-unified.css?v=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="icon" type="image/svg+xml" href="/public/images/logo.svg">
</head>
<body class="dark-mode">
    <!-- Skip to main content -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Innovative Navigation -->
    <nav class="nav-modern">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html" class="logo-animated">
                    <div class="logo-icon">
                        <img src="/public/images/logo.svg" alt="MangaMotion Logo">
                        <div class="logo-pulse"></div>
                    </div>
                    <span class="logo-text">MangaMotion</span>
                </a>
            </div>

            <div class="nav-main">
                <div class="nav-links">
                    <a href="index.html#features" class="nav-link" data-tooltip="Discover features">
                        <i class="fas fa-sparkles"></i>
                        <span>Features</span>
                    </a>
                    <a href="pricing.html" class="nav-link" data-tooltip="View pricing">
                        <i class="fas fa-crown"></i>
                        <span>Pricing</span>
                    </a>
                    <a href="#api" class="nav-link" data-tooltip="API docs">
                        <i class="fas fa-code"></i>
                        <span>API</span>
                    </a>
                    <a href="#docs" class="nav-link" data-tooltip="Documentation">
                        <i class="fas fa-book"></i>
                        <span>Docs</span>
                    </a>
                </div>

                <div class="nav-actions">
                    <a href="dashboard.html" class="btn btn-primary btn-glow">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
            </div>

            <!-- Mobile Menu Trigger -->
            <button class="mobile-menu-trigger" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay">
            <div class="mobile-menu">
                <div class="mobile-menu-header">
                    <div class="logo-mobile">
                        <img src="/public/images/logo.svg" alt="MangaMotion">
                        <span>MangaMotion</span>
                    </div>
                    <button class="mobile-menu-close" aria-label="Close menu">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <nav class="mobile-nav">
                    <a href="index.html#features" class="mobile-nav-link">
                        <i class="fas fa-sparkles"></i>
                        <span>Features</span>
                    </a>
                    <a href="pricing.html" class="mobile-nav-link">
                        <i class="fas fa-crown"></i>
                        <span>Pricing</span>
                    </a>
                    <a href="#api" class="mobile-nav-link">
                        <i class="fas fa-code"></i>
                        <span>API</span>
                    </a>
                    <a href="#docs" class="mobile-nav-link">
                        <i class="fas fa-book"></i>
                        <span>Docs</span>
                    </a>
                    <div class="mobile-nav-divider"></div>
                    <a href="dashboard.html" class="mobile-nav-link primary">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </nav>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="pt-16 h-screen flex">
        <!-- Left Sidebar: Panels List -->
        <div class="w-64 sidebar p-4 overflow-y-auto">
            <h3 class="text-lg font-bold mb-4">Panels</h3>
            <div class="space-y-3">
                <div class="panel-thumbnail w-full h-20 rounded-lg flex items-center justify-center text-white relative active" data-panel="1">
                    <i class="fas fa-image text-2xl"></i>
                    <div class="absolute top-1 right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-black text-xs font-bold">1</div>
                </div>
                <div class="panel-thumbnail w-full h-20 rounded-lg flex items-center justify-center text-white relative" data-panel="2">
                    <i class="fas fa-image text-2xl"></i>
                    <div class="absolute top-1 right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-black text-xs font-bold">2</div>
                </div>
                <div class="panel-thumbnail w-full h-20 rounded-lg flex items-center justify-center text-white relative" data-panel="3">
                    <i class="fas fa-image text-2xl"></i>
                    <div class="absolute top-1 right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-black text-xs font-bold">3</div>
                </div>
            </div>
        </div>

        <!-- Center: Canvas -->
        <div class="flex-1 flex flex-col">
            <!-- Canvas Area -->
            <div class="flex-1 p-6">
                <div class="canvas-area rounded-2xl p-6 h-full">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Canvas Preview</h3>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-400">Panel 1 of 3</span>
                            <button class="play-button w-12 h-12 rounded-full flex items-center justify-center" onclick="togglePlayback()">
                                <i id="playIcon" class="fas fa-play text-white"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Canvas Preview -->
                    <div class="canvas-preview rounded-xl mb-4 flex items-center justify-center">
                        <div class="text-white text-opacity-50 text-center">
                            <i class="fas fa-book text-6xl mb-4"></i>
                            <p>Panel Preview</p>
                        </div>
                    </div>
                    
                    <!-- Timeline Scrubber -->
                    <div class="mb-4">
                        <input type="range" class="slider w-full" min="0" max="100" value="0" id="timelineScrubber">
                    </div>
                </div>
            </div>

            <!-- Bottom Timeline -->
            <div class="timeline p-4">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-bold">Timeline</h4>
                    <span class="text-sm text-gray-400">0:00 / 0:15</span>
                </div>
                
                <div class="space-y-2">
                    <!-- Panel Track -->
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-400 w-16">Panels</span>
                        <div class="timeline-track flex-1">
                            <div class="timeline-item" style="left: 0%; width: 33.33%;"></div>
                            <div class="timeline-item" style="left: 33.33%; width: 33.33%;"></div>
                            <div class="timeline-item" style="left: 66.66%; width: 33.34%;"></div>
                        </div>
                    </div>
                    
                    <!-- Audio Track -->
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-400 w-16">Audio</span>
                        <div class="timeline-track flex-1">
                            <div class="timeline-item" style="left: 0%; width: 30%;"></div>
                            <div class="timeline-item" style="left: 35%; width: 25%;"></div>
                        </div>
                    </div>
                    
                    <!-- SFX Track -->
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-400 w-16">SFX</span>
                        <div class="timeline-track flex-1">
                            <div class="timeline-item" style="left: 45%; width: 5%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar: Controls -->
        <div class="w-80 sidebar p-4 overflow-y-auto">
            <h3 class="text-lg font-bold mb-4">Controls</h3>
            
            <!-- Control Tabs -->
            <div class="flex space-x-2 mb-6">
                <button onclick="switchTab('motion')" class="control-tab px-4 py-2 rounded-lg text-sm font-medium flex-1 active" id="motionTab">
                    <i class="fas fa-running mr-2"></i>Motion
                </button>
                <button onclick="switchTab('audio')" class="control-tab px-4 py-2 rounded-lg text-sm font-medium flex-1" id="audioTab">
                    <i class="fas fa-microphone mr-2"></i>Audio
                </button>
                <button onclick="switchTab('sfx')" class="control-tab px-4 py-2 rounded-lg text-sm font-medium flex-1" id="sfxTab">
                    <i class="fas fa-volume-up mr-2"></i>SFX
                </button>
            </div>

            <!-- Motion Controls -->
            <div id="motionControls" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Motion Style</label>
                    <select class="dropdown w-full px-4 py-3 rounded-lg text-white focus:outline-none">
                        <option value="soft-pan">Soft Pan</option>
                        <option value="dynamic-zoom">Dynamic Zoom</option>
                        <option value="shake">Shake (Anger)</option>
                        <option value="slow-drift">Slow Drift (Sad)</option>
                        <option value="snap-cut">Snap Cut (Shonen)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Duration: <span id="durationValue">3.0s</span></label>
                    <input type="range" class="slider w-full" min="1" max="10" value="3" step="0.5" id="durationSlider" oninput="updateDuration(this.value)">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Emotion Boost: <span id="emotionValue">50%</span></label>
                    <input type="range" class="slider w-full" min="0" max="100" value="50" id="emotionSlider" oninput="updateEmotion(this.value)">
                </div>
                
                <div class="pt-4 border-t border-white/10">
                    <button onclick="previewMotion()" class="w-full py-3 rounded-lg bg-gradient-to-r from-purple-500 to-blue-500 text-white font-bold hover:shadow-lg transition-all">
                        <i class="fas fa-play mr-2"></i>Preview Motion
                    </button>
                </div>
            </div>

            <!-- Audio Controls -->
            <div id="audioControls" class="space-y-6 hidden">
                <div class="flex items-center justify-between p-3 rounded-lg bg-white/5">
                    <span class="text-sm">Voice Credits</span>
                    <span id="voiceCreditsBadge" class="text-sm font-bold text-green-400">--</span>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Dialog Text</label>
                    <textarea class="dropdown w-full px-4 py-3 rounded-lg text-white focus:outline-none resize-none" rows="3" placeholder="Enter character dialog..."></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">AI Voice</label>
                    <select class="dropdown w-full px-4 py-3 rounded-lg text-white focus:outline-none">
                        <option value="male-hero">Male Hero</option>
                        <option value="female-hero">Female Hero</option>
                        <option value="villain">Villain</option>
                        <option value="narrator">Narrator</option>
                        <option value="child">Child</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Voice Emotion: <span id="voiceEmotionValue">Neutral</span></label>
                    <input type="range" class="slider w-full" min="0" max="100" value="50" id="voiceEmotionSlider" oninput="updateVoiceEmotion(this.value)">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="generateVoice()" class="flex-1 py-3 rounded-lg bg-gradient-to-r from-green-500 to-blue-500 text-white font-bold hover:shadow-lg transition-all">
                        <i class="fas fa-magic mr-2"></i>Generate
                    </button>
                    <button onclick="playAudio()" class="flex-1 py-3 rounded-lg bg-white/10 hover:bg-white/20 text-white font-bold transition-all">
                        <i class="fas fa-play mr-2"></i>Play
                    </button>
                </div>
            </div>

            <!-- SFX Controls -->
            <div id="sfxControls" class="space-y-6 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Sound Effects</label>
                    <div class="space-y-2 max-h-64 overflow-y-auto">
                        <div class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-all cursor-pointer">
                            <span class="text-sm">Punch Impact</span>
                            <button class="text-purple-400 hover:text-purple-300">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-all cursor-pointer">
                            <span class="text-sm">Sword Slash</span>
                            <button class="text-purple-400 hover:text-purple-300">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-all cursor-pointer">
                            <span class="text-sm">Explosion</span>
                            <button class="text-purple-400 hover:text-purple-300">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-all cursor-pointer">
                            <span class="text-sm">Wind Gust</span>
                            <button class="text-purple-400 hover:text-purple-300">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Background Music</label>
                    <select class="dropdown w-full px-4 py-3 rounded-lg text-white focus:outline-none">
                        <option value="none">None</option>
                        <option value="epic-battle">Epic Battle</option>
                        <option value="emotional">Emotional</option>
                        <option value="suspense">Suspense</option>
                        <option value="comedy">Comedy</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <!-- Standardized MangaMotion Footer -->
    <footer class="footer">
        <!-- Brand Section -->
        <div class="footer-brand-section">
            <div class="footer-brand">
                <div class="footer-logo">
                    <div class="logo-icon">
                        <img src="/public/images/logo.svg" alt="MangaMotion Logo">
                    </div>
                    <span class="logo-text">MangaMotion</span>
                </div>
                <p class="footer-description">Transform your manga into cinematic animations with AI-powered technology.</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook" class="social-icon">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" aria-label="Twitter" class="social-icon">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" aria-label="Instagram" class="social-icon">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" aria-label="YouTube" class="social-icon">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="#" aria-label="Discord" class="social-icon">
                        <i class="fab fa-discord"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Links Section -->
        <div class="footer-links-section">
            <div class="footer-column">
                <h3 class="footer-heading">
                    <span class="heading-icon">♦</span>Product
                </h3>
                <ul class="footer-links">
                    <li><a href="index.html#features" class="footer-link">Features</a></li>
                    <li><a href="pricing.html" class="footer-link">Pricing</a></li>
                    <li><a href="index.html#api" class="footer-link">API</a></li>
                    <li><a href="index.html#docs" class="footer-link">Documentation</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3 class="footer-heading">
                    <span class="heading-icon">♦</span>Company
                </h3>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">About Us</a></li>
                    <li><a href="#" class="footer-link">Blog</a></li>
                    <li><a href="#" class="footer-link">Careers</a></li>
                    <li><a href="#" class="footer-link">Contact</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3 class="footer-heading">
                    <span class="heading-icon">♦</span>Support
                </h3>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">Help Center</a></li>
                    <li><a href="#" class="footer-link">Documentation</a></li>
                    <li><a href="#" class="footer-link">Community</a></li>
                    <li><a href="#" class="footer-link">System Status</a></li>
                </ul>
            </div>
        </div>

        <!-- Newsletter Section -->
        <div class="footer-newsletter-section">
            <div class="newsletter-box">
                <h3 class="newsletter-title">
                    <span class="newsletter-icon">✉</span>Stay Updated
                </h3>
                <p class="newsletter-description">Get the latest updates, features, and anime animation tips.</p>
                <form class="newsletter-form">
                    <input 
                        type="email" 
                        placeholder="Enter your email" 
                        class="newsletter-input" 
                        required
                        aria-label="Email address"
                    >
                    <button type="submit" class="newsletter-btn">
                        <i class="fas fa-paper-plane"></i>Subscribe
                    </button>
                </form>
                <p class="newsletter-note">No spam, unsubscribe anytime.</p>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="footer-bottom">
            <p class="footer-copyright">&copy; 2024 MangaMotion. All rights reserved.</p>
            <div class="footer-legal">
                <a href="#" class="legal-link">Privacy Policy</a>
                <span class="legal-separator">•</span>
                <a href="#" class="legal-link">Terms of Service</a>
                <span class="legal-separator">•</span>
                <a href="#" class="legal-link">Cookie Policy</a>
            </div>
        </div>
    </footer>
    </main>

    <script>
        // Enhanced Navigation Functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu functionality
            const mobileMenuTrigger = document.querySelector('.mobile-menu-trigger');
            const mobileMenuOverlay = document.querySelector('.mobile-menu-overlay');
            const mobileMenuClose = document.querySelector('.mobile-menu-close');

            if (mobileMenuTrigger && mobileMenuOverlay) {
                mobileMenuTrigger.addEventListener('click', () => {
                    mobileMenuOverlay.classList.add('active');
                });

                mobileMenuClose.addEventListener('click', () => {
                    mobileMenuOverlay.classList.remove('active');
                });

                mobileMenuOverlay.addEventListener('click', (e) => {
                    if (e.target === mobileMenuOverlay) {
                        mobileMenuOverlay.classList.remove('active');
                    }
                });
            }

            // Newsletter form submission
            const newsletterForm = document.querySelector('.newsletter-form');
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = newsletterForm.querySelector('input').value;
                    if (email) {
                        const button = newsletterForm.querySelector('button');
                        const originalText = button.textContent;
                        button.textContent = 'Subscribed!';
                        button.style.background = '#10B981';

                        setTimeout(() => {
                            button.textContent = originalText;
                            button.style.background = '';
                            newsletterForm.reset();
                        }, 2000);
                    }
                });
            }

            // Add tooltip functionality
            const navLinks = document.querySelectorAll('.nav-link[data-tooltip]');
            navLinks.forEach(link => {
                const tooltip = document.createElement('div');
                tooltip.className = 'nav-tooltip';
                tooltip.textContent = link.dataset.tooltip;
                link.appendChild(tooltip);
            });

            // Add scroll effect to navigation
            let lastScrollTop = 0;
            const nav = document.querySelector('.nav-modern');

            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    if (nav) nav.style.transform = 'translateY(-100%)';
                } else {
                    if (nav) nav.style.transform = 'translateY(0)';
                }

                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            });

            // Initialize Intersection Observer for animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, observerOptions);

            // Observe elements for animation
            document.querySelectorAll('#main-content').forEach(card => {
                observer.observe(card);
            });
        });

        // Editor functionality
        let isPlaying = false;

        function switchTab(tab) {
            // Hide all control panels
            document.getElementById('motionControls').classList.add('hidden');
            document.getElementById('audioControls').classList.add('hidden');
            document.getElementById('sfxControls').classList.add('hidden');
            
            // Remove active class from all tabs
            document.getElementById('motionTab').classList.remove('active');
            document.getElementById('audioTab').classList.remove('active');
            document.getElementById('sfxTab').classList.remove('active');
            
            // Show selected panel and activate tab
            document.getElementById(tab + 'Controls').classList.remove('hidden');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function updateDuration(value) {
            document.getElementById('durationValue').textContent = value + 's';
        }

        function updateEmotion(value) {
            document.getElementById('emotionValue').textContent = value + '%';
        }

        function updateVoiceEmotion(value) {
            const emotions = ['Angry', 'Serious', 'Neutral', 'Happy', 'Excited'];
            const emotionIndex = Math.floor(value / 25);
            document.getElementById('voiceEmotionValue').textContent = emotions[emotionIndex] || 'Neutral';
        }

        function togglePlayback() {
            const playIcon = document.getElementById('playIcon');
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                playIcon.className = 'fas fa-pause text-white';
                startPlayback();
            } else {
                playIcon.className = 'fas fa-play text-white';
                stopPlayback();
            }
        }

        function startPlayback() {
            const scrubber = document.getElementById('timelineScrubber');
            let progress = parseInt(scrubber.value);
            
            const playbackInterval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(playbackInterval);
                    return;
                }
                
                progress += 1;
                scrubber.value = progress;
                
                if (progress >= 100) {
                    togglePlayback();
                    scrubber.value = 0;
                }
            }, 150);
        }

        function stopPlayback() {
            // Playback stopped
        }

        function previewMotion() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Previewing...';
            button.disabled = true;
            
            // Animate canvas preview
            anime({
                targets: '.canvas-preview',
                scale: [1, 1.05, 1],
                duration: 1000,
                easing: 'easeInOutQuart'
            });
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }

        let voiceGenInterval;
        function generateVoice() {
            const text = (document.querySelector('#audioControls textarea')||{}).value || 'This is a demo line.';
            const voiceSel = (document.querySelector('#audioControls select')||{}).value || 'female-hero';
            const emotion = (document.getElementById('voiceEmotionValue')||{}).textContent || 'Neutral';

            const credits = parseInt(localStorage.getItem('voice_credits') || '5', 10);
            if (credits <= 0) {
                alert('You are out of voice credits. Please upgrade to continue.');
                if (window.trackEvent) window.trackEvent('voice_generate_blocked_no_credits');
                return;
            }
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            button.disabled = true;
            // Progress + ETA
            let progress = 0;
            const start = Date.now();
            const progressBar = document.createElement('div');
            progressBar.className = 'w-full h-2 bg-white/10 rounded my-3';
            progressBar.innerHTML = '<div id="voiceProgressFill" class="h-2 bg-green-500 rounded" style="width:0%"></div>';
            const etaEl = document.createElement('div');
            etaEl.id = 'voiceEta';
            etaEl.className = 'text-xs text-gray-400 mb-2';
            etaEl.textContent = 'ETA: --';
            const controls = document.getElementById('audioControls');
            controls.insertBefore(etaEl, controls.children[controls.children.length-1]);
            controls.insertBefore(progressBar, controls.children[controls.children.length-1]);
            if (window.trackEvent) window.trackEvent('voice_generated', { preset: 'single_line' });
            // Call backend mock
            fetch('/api/generate-voice', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ text, voiceId: voiceSel, emotion }) })
                .then(r=>r.json()).then(resp => {
                    if (window.trackEvent) window.trackEvent('voice_generated', { preset: 'single_line', cost: resp.costEstimate });
                }).catch(()=>{});

            voiceGenInterval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress > 100) progress = 100;
                const fill = document.getElementById('voiceProgressFill');
                if (fill) fill.style.width = progress + '%';
                const elapsed = (Date.now() - start) / 1000;
                const totalEst = elapsed / Math.max(progress/100, 0.01);
                const remaining = Math.max(totalEst - elapsed, 0);
                const m = Math.floor(remaining / 60);
                const s = Math.floor(remaining % 60);
                etaEl.textContent = `ETA: ${m}:${s.toString().padStart(2,'0')}`;
                if (progress >= 100) {
                    clearInterval(voiceGenInterval);
                    // Deduct credit
                    const newCredits = Math.max(credits - 1, 0);
                    localStorage.setItem('voice_credits', String(newCredits));
                    updateVoiceCredits();
                    button.innerHTML = originalText;
                    button.disabled = false;
                    alert('Voice generated successfully!');
                }
            }, 250);
        }

        function playAudio() {
            // Simulate audio playback
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-stop mr-2"></i>Stop';
            
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 3000);
        }

        function saveProject() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                alert('Project saved successfully!');
            }, 1500);
        }

        function exportVideo() {
            window.location.href = 'export.html';
        }

        // New timeline functions
        function zoomTimeline(direction) {
            // Simulate zoom functionality
            const tracks = document.querySelectorAll('.timeline-track');
            tracks.forEach(track => {
                if (direction === 'in') {
                    track.style.height = '12px';
                } else {
                    track.style.height = '8px';
                }
            });
        }

        function rewindTimeline() {
            document.getElementById('timelineScrubber').value = 0;
        }

        function stepBackward() {
            const scrubber = document.getElementById('timelineScrubber');
            scrubber.value = Math.max(0, parseInt(scrubber.value) - 10);
        }

        function stepForward() {
            const scrubber = document.getElementById('timelineScrubber');
            scrubber.value = Math.min(100, parseInt(scrubber.value) + 10);
        }

        function fastForwardTimeline() {
            document.getElementById('timelineScrubber').value = 100;
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    togglePlayback();
                    break;
                case 'ArrowLeft':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        stepBackward();
                    }
                    break;
                case 'ArrowRight':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        stepForward();
                    }
                    break;
                case 'Home':
                    e.preventDefault();
                    rewindTimeline();
                    break;
                case 'End':
                    e.preventDefault();
                    fastForwardTimeline();
                    break;
            }
        });

        // Panel thumbnail selection
        document.querySelectorAll('.panel-thumbnail').forEach(thumbnail => {
            thumbnail.addEventListener('click', function() {
                document.querySelectorAll('.panel-thumbnail').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        function updateVoiceCredits() {
            const badge = document.getElementById('voiceCreditsBadge');
            const credits = parseInt(localStorage.getItem('voice_credits') || '5', 10);
            badge.textContent = credits + ' left';
            badge.className = 'text-sm font-bold ' + (credits > 0 ? 'text-green-400' : 'text-red-400');
        }
        document.addEventListener('DOMContentLoaded', updateVoiceCredits);

        // Animate elements on load
        anime({
            targets: '.sidebar',
            opacity: [0, 1],
            translateX: [30, 0],
            duration: 800,
            delay: anime.stagger(200),
            easing: 'easeOutQuart'
        });

        anime({
            targets: '.canvas-area',
            opacity: [0, 1],
            scale: [0.9, 1],
            duration: 1000,
            easing: 'easeOutQuart'
        });

        anime({
            targets: '.timeline',
            opacity: [0, 1],
            translateY: [30, 0],
            duration: 800,
            delay: 400,
            easing: 'easeOutQuart'
        });
    </script>
</body>
</html>